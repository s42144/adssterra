<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shark Bounty - Enhanced Admin Panel</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    :root {
      --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      --danger-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      --dark-bg: #0f2027;
      --card-bg: rgba(255, 255, 255, 0.08);
      --card-border: rgba(255, 255, 255, 0.15);
      --text-primary: #ffffff;
      --text-secondary: #b8c5d6;
      --accent-cyan: #00f2fe;
      --accent-gold: #ffd700;
      --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.15);
      --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.2);
    }
    
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
      color: var(--text-primary);
      min-height: 100vh;
      padding: 20px;
    }
    
    .admin-container {
      max-width: 1400px;
      margin: 0 auto;
    }
    
    .admin-header {
      text-align: center;
      margin-bottom: 40px;
    }
    
    .admin-title {
      font-size: 36px;
      font-weight: 800;
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 8px;
    }
    
    .admin-subtitle {
      font-size: 16px;
      color: var(--text-secondary);
    }
    
    .stats-overview {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }
    
    .stat-card {
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      padding: 24px;
      border: 1px solid var(--card-border);
      box-shadow: var(--shadow-md);
      transition: all 0.3s ease;
    }
    
    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
    }
    
    .stat-icon {
      font-size: 32px;
      margin-bottom: 12px;
    }
    
    .stat-label {
      font-size: 13px;
      color: var(--text-secondary);
      font-weight: 600;
      text-transform: uppercase;
      margin-bottom: 8px;
    }
    
    .stat-value {
      font-size: 32px;
      font-weight: 800;
      color: var(--accent-cyan);
    }
    
    .admin-tabs {
      display: flex;
      gap: 12px;
      margin-bottom: 30px;
      overflow-x: auto;
      padding-bottom: 10px;
    }
    
    .admin-tab-btn {
      padding: 12px 24px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      color: var(--text-secondary);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      white-space: nowrap;
    }
    
    .admin-tab-btn.active {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      color: #fff;
      border-color: transparent;
    }
    
    .admin-tab-content {
      display: none;
    }
    
    .admin-tab-content.active {
      display: block;
    }
    
    .section-card {
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      padding: 24px;
      border: 1px solid var(--card-border);
      box-shadow: var(--shadow-md);
      margin-bottom: 24px;
    }
    
    .section-title {
      font-size: 20px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .section-icon {
      font-size: 24px;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-label {
      display: block;
      font-size: 13px;
      color: var(--text-secondary);
      font-weight: 600;
      margin-bottom: 8px;
    }
    
    .form-input {
      width: 100%;
      padding: 12px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      color: var(--text-primary);
      font-size: 14px;
    }
    
    .form-input::placeholder {
      color: var(--text-secondary);
    }
    
    .btn-primary {
      padding: 12px 24px;
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      border: none;
      border-radius: 12px;
      color: #fff;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(79, 172, 254, 0.4);
    }
    
    .btn-danger {
      padding: 12px 24px;
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      border: none;
      border-radius: 12px;
      color: #fff;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .btn-danger:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(240, 147, 251, 0.4);
    }
    
    .table-container {
      overflow-x: auto;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
    }
    
    thead {
      background: rgba(255, 255, 255, 0.05);
    }
    
    th {
      padding: 12px;
      text-align: left;
      font-size: 12px;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    td {
      padding: 16px 12px;
      font-size: 14px;
      color: var(--text-primary);
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    tbody tr {
      transition: all 0.3s ease;
    }
    
    tbody tr:hover {
      background: rgba(255, 255, 255, 0.05);
    }
    
    .status-badge {
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      display: inline-block;
    }
    
    .status-pending {
      background: rgba(255, 193, 7, 0.2);
      color: #ffc107;
    }
    
    .status-approved {
      background: rgba(76, 175, 80, 0.2);
      color: #4caf50;
    }
    
    .status-rejected {
      background: rgba(244, 67, 54, 0.2);
      color: #f44336;
    }
    
    .action-btn {
      padding: 6px 16px;
      border: none;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-right: 8px;
      text-transform: uppercase;
    }
    
    .btn-approve {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      color: #fff;
    }
    
    .btn-approve:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(79, 172, 254, 0.4);
    }
    
    .btn-reject {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: #fff;
    }
    
    .btn-reject:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(240, 147, 251, 0.4);
    }
    
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-secondary);
    }
    
    .empty-icon {
      font-size: 64px;
      margin-bottom: 16px;
    }
    
    .empty-text {
      font-size: 16px;
      font-weight: 600;
    }
    
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      color: #fff;
      padding: 16px 24px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
      z-index: 10000;
      animation: slideIn 0.3s ease;
    }
    
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(100px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }
    
    .code-list {
      display: grid;
      gap: 16px;
    }
    
    .code-item {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      padding: 16px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .code-info {
      flex: 1;
    }
    
    .code-value {
      font-size: 20px;
      font-weight: 700;
      color: var(--accent-cyan);
      font-family: 'Courier New', monospace;
      margin-bottom: 8px;
    }
    
    .code-details {
      font-size: 12px;
      color: var(--text-secondary);
    }
    
    .code-actions {
      display: flex;
      gap: 8px;
    }
    
    .search-box {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
    }
    
    .search-input {
      flex: 1;
      padding: 12px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      color: var(--text-primary);
      font-size: 14px;
    }
    
    .user-result {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      padding: 20px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      margin-bottom: 20px;
    }
    
    .user-header {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 20px;
    }
    
    .user-avatar {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      border: 2px solid var(--accent-cyan);
    }
    
    .user-info {
      flex: 1;
    }
    
    .user-name {
      font-size: 20px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 4px;
    }
    
    .user-id {
      font-size: 14px;
      color: var(--text-secondary);
    }
    
    .user-balances {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 20px;
    }
    
    .balance-box {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      padding: 16px;
      text-align: center;
    }
    
    .balance-label {
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }
    
    .balance-value {
      font-size: 24px;
      font-weight: 700;
      color: var(--accent-cyan);
    }
    
    .balance-actions {
      display: flex;
      gap: 12px;
      margin-top: 20px;
    }
    
    .balance-input {
      flex: 1;
      padding: 12px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      color: var(--text-primary);
      font-size: 14px;
    }
  </style>
<script src="https://sites.super.myninja.ai/_assets/ninja-daytona-script.js"></script>
</head>
<body>
  <div class="admin-container">
    <div class="admin-header">
      <div class="admin-title">🦈 Shark Bounty Admin Panel</div>
      <div class="admin-subtitle">Enhanced Trading Platform Management</div>
    </div>
    
    <div class="stats-overview">
      <div class="stat-card">
        <div class="stat-icon">👥</div>
        <div class="stat-label">Total Users</div>
        <div class="stat-value" id="totalUsers">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">💰</div>
        <div class="stat-label">Total Deposits</div>
        <div class="stat-value" id="totalDeposits">$0</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">💸</div>
        <div class="stat-label">Total Withdrawals</div>
        <div class="stat-value" id="totalWithdrawals">$0</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">📊</div>
        <div class="stat-label">Active Trades</div>
        <div class="stat-value" id="activeTrades">0</div>
      </div>
    </div>
    
    <div class="admin-tabs">
      <button class="admin-tab-btn active" data-tab="deposits">Deposits</button>
      <button class="admin-tab-btn" data-tab="withdrawals">Withdrawals</button>
      <button class="admin-tab-btn" data-tab="trades">Trades</button>
      <button class="admin-tab-btn" data-tab="redeem-codes">Redeem Codes</button>
      <button class="admin-tab-btn" data-tab="user-search">User Search</button>
      <button class="admin-tab-btn" data-tab="redemptions">Redemptions Log</button>
    </div>
    
    <!-- Deposits Tab -->
    <div id="deposits-tab" class="admin-tab-content active">
      <div class="section-card">
        <div class="section-title">
          <span class="section-icon">💰</span>
          Pending Deposits
        </div>
        <div class="table-container">
          <table id="depositsTable">
            <thead>
              <tr>
                <th>User</th>
                <th>Amount</th>
                <th>Memo</th>
                <th>TX Hash</th>
                <th>Date</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="depositsTableBody"></tbody>
          </table>
        </div>
      </div>
    </div>
    
    <!-- Withdrawals Tab -->
    <div id="withdrawals-tab" class="admin-tab-content">
      <div class="section-card">
        <div class="section-title">
          <span class="section-icon">💸</span>
          Pending Withdrawals
        </div>
        <div class="table-container">
          <table id="withdrawalsTable">
            <thead>
              <tr>
                <th>User</th>
                <th>Amount</th>
                <th>Address</th>
                <th>Memo</th>
                <th>Date</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="withdrawalsTableBody"></tbody>
          </table>
        </div>
      </div>
    </div>
    
    <!-- Trades Tab -->
    <div id="trades-tab" class="admin-tab-content">
      <div class="section-card">
        <div class="section-title">
          <span class="section-icon">📊</span>
          All Trades
        </div>
        <div class="table-container">
          <table id="tradesTable">
            <thead>
              <tr>
                <th>User</th>
                <th>Pair</th>
                <th>Investment</th>
                <th>Daily Earning</th>
                <th>Days Completed</th>
                <th>Total Earned</th>
                <th>Status</th>
                <th>Date</th>
              </tr>
            </thead>
            <tbody id="tradesTableBody"></tbody>
          </table>
        </div>
      </div>
    </div>
    
    <!-- Redeem Codes Tab -->
    <div id="redeem-codes-tab" class="admin-tab-content">
      <div class="section-card">
        <div class="section-title">
          <span class="section-icon">🎁</span>
          Generate Redeem Code
        </div>
        <div class="form-group">
          <label class="form-label">Code (5 digits, leave empty for auto-generate)</label>
          <input type="text" class="form-input" id="codeValue" placeholder="XXXXX" maxlength="5" />
        </div>
        <div class="form-group">
          <label class="form-label">Maximum Uses</label>
          <input type="number" class="form-input" id="codeMaxUses" placeholder="100" min="1" value="100" />
        </div>
        <div class="form-group">
          <label class="form-label">Number of Codes to Generate</label>
          <input type="number" class="form-input" id="codeBulkCount" placeholder="1" min="1" max="100" value="1" />
        </div>
        <button class="btn-primary" id="generateCodeBtn">Generate Code(s)</button>
      </div>
      
      <div class="section-card">
        <div class="section-title">
          <span class="section-icon">📋</span>
          Active Redeem Codes
        </div>
        <div class="code-list" id="codesList"></div>
      </div>
    </div>
    
    <!-- User Search Tab -->
    <div id="user-search-tab" class="admin-tab-content">
      <div class="section-card">
        <div class="section-title">
          <span class="section-icon">🔍</span>
          Search User
        </div>
        <div class="search-box">
          <input type="text" class="search-input" id="userSearchInput" placeholder="Enter User ID" />
          <button class="btn-primary" id="searchUserBtn">Search</button>
        </div>
        <div id="userSearchResult"></div>
      </div>
    </div>
    
    <!-- Redemptions Log Tab -->
    <div id="redemptions-tab" class="admin-tab-content">
      <div class="section-card">
        <div class="section-title">
          <span class="section-icon">📜</span>
          Redemptions History
        </div>
        <div class="table-container">
          <table id="redemptionsTable">
            <thead>
              <tr>
                <th>User</th>
                <th>Code</th>
                <th>Reward</th>
                <th>Date</th>
              </tr>
            </thead>
            <tbody id="redemptionsTableBody"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAHofuS76xf2oGPaJqEtopmcxdoJzjkDL4",
      authDomain: "zmex-investments.firebaseapp.com",
      databaseURL: "https://zmex-investments-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "zmex-investments",
      storageBucket: "zmex-investments.appspot.com",
      messagingSenderId: "971623941364",
      appId: "1:971623941364:web:6c65604fc45c3f64e74aa1",
      measurementId: "G-KQ1LYP77JF"
    };
    
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    
    function notify(message) {
      const notification = document.createElement('div');
      notification.className = 'notification';
      notification.textContent = message;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.remove();
      }, 3000);
    }
    
    function now() {
      return Math.floor(Date.now() / 1000);
    }
    
    // Tab Switching
    document.querySelectorAll('.admin-tab-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        document.querySelectorAll('.admin-tab-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        
        document.querySelectorAll('.admin-tab-content').forEach(content => {
          content.classList.remove('active');
        });
        
        const tabName = this.dataset.tab;
        document.getElementById(`${tabName}-tab`).classList.add('active');
        
        if (tabName === 'deposits') loadDeposits();
        else if (tabName === 'withdrawals') loadWithdrawals();
        else if (tabName === 'trades') loadTrades();
        else if (tabName === 'redeem-codes') loadRedeemCodes();
        else if (tabName === 'redemptions') loadRedemptions();
      });
    });
    
    // Load Statistics
    function loadStatistics() {
      db.ref('users').once('value').then(snapshot => {
        const totalUsers = snapshot.numChildren();
        document.getElementById('totalUsers').textContent = totalUsers;
        
        let totalDeposits = 0;
        let totalWithdrawals = 0;
        let activeTrades = 0;
        
        snapshot.forEach(child => {
          const userData = child.val();
          if (userData.trading) {
            totalDeposits += userData.trading.totalDeposited || 0;
            
            if (userData.trading.activeTrades) {
              activeTrades += Object.keys(userData.trading.activeTrades).length;
            }
          }
        });
        
        document.getElementById('totalDeposits').textContent = '$' + totalDeposits.toFixed(2);
        document.getElementById('activeTrades').textContent = activeTrades;
      });
      
      db.ref('admin/trading/withdrawals').once('value').then(snapshot => {
        let total = 0;
        snapshot.forEach(child => {
          const withdrawal = child.val();
          if (withdrawal.status === 'approved') {
            total += withdrawal.amount || 0;
          }
        });
        document.getElementById('totalWithdrawals').textContent = '$' + total.toFixed(2);
      });
    }
    
    // Load Deposits
    function loadDeposits() {
      db.ref('admin/trading/deposits').on('value', snapshot => {
        const tbody = document.getElementById('depositsTableBody');
        tbody.innerHTML = '';
        
        if (!snapshot.exists()) {
          tbody.innerHTML = '<tr><td colspan="7"><div class="empty-state"><div class="empty-icon">📭</div><div class="empty-text">No deposits yet</div></div></td></tr>';
          return;
        }
        
        snapshot.forEach(child => {
          const deposit = child.val();
          const depositKey = child.key;
          
          if (deposit.status === 'pending') {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${deposit.userName}<br><small>${deposit.userId}</small></td>
              <td>$${deposit.amount}</td>
              <td>${deposit.memo}</td>
              <td><small>${deposit.txHash.substring(0, 20)}...</small></td>
              <td>${new Date(deposit.timestamp * 1000).toLocaleString()}</td>
              <td><span class="status-badge status-${deposit.status}">${deposit.status}</span></td>
              <td>
                <button class="action-btn btn-approve" onclick="approveDeposit('${depositKey}', '${deposit.userId}', '${deposit.depositId}', ${deposit.amount})">Approve</button>
                <button class="action-btn btn-reject" onclick="rejectDeposit('${depositKey}', '${deposit.userId}', '${deposit.depositId}')">Reject</button>
              </td>
            `;
            tbody.appendChild(row);
          }
        });
      });
    }
    
    // Approve Deposit
    function approveDeposit(adminKey, userId, depositId, amount) {
      if (!confirm(`Approve deposit of $${amount}?`)) return;
      
      // Update user balance
      db.ref(`users/${userId}/trading/usdtBalance`).transaction(balance => {
        return (balance || 0) + amount;
      });
      
      // Update total deposited
      db.ref(`users/${userId}/trading/totalDeposited`).transaction(total => {
        return (total || 0) + amount;
      });
      
      // Update deposit status in admin
      db.ref(`admin/trading/deposits/${adminKey}`).update({
        status: 'approved',
        approvedAt: now()
      });
      
      // Update deposit status in user's history
      db.ref(`users/${userId}/trading/depositHistory/${depositId}`).update({
        status: 'approved',
        approvedAt: now()
      });
      
      notify('Deposit approved successfully!');
    }
    
    // Reject Deposit
    function rejectDeposit(adminKey, userId, depositId) {
      if (!confirm('Reject this deposit?')) return;
      
      // Update deposit status in admin
      db.ref(`admin/trading/deposits/${adminKey}`).update({
        status: 'rejected',
        rejectedAt: now()
      });
      
      // Update deposit status in user's history
      db.ref(`users/${userId}/trading/depositHistory/${depositId}`).update({
        status: 'rejected',
        rejectedAt: now()
      });
      
      notify('Deposit rejected!');
    }
    
    // Load Withdrawals
    function loadWithdrawals() {
      db.ref('admin/trading/withdrawals').on('value', snapshot => {
        const tbody = document.getElementById('withdrawalsTableBody');
        tbody.innerHTML = '';
        
        if (!snapshot.exists()) {
          tbody.innerHTML = '<tr><td colspan="7"><div class="empty-state"><div class="empty-icon">📭</div><div class="empty-text">No withdrawals yet</div></div></td></tr>';
          return;
        }
        
        snapshot.forEach(child => {
          const withdrawal = child.val();
          const withdrawalKey = child.key;
          
          if (withdrawal.status === 'pending') {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${withdrawal.userName}<br><small>${withdrawal.userId}</small></td>
              <td>$${withdrawal.amount}</td>
              <td><small>${withdrawal.address.substring(0, 20)}...</small></td>
              <td>${withdrawal.memo || 'N/A'}</td>
              <td>${new Date(withdrawal.timestamp * 1000).toLocaleString()}</td>
              <td><span class="status-badge status-${withdrawal.status}">${withdrawal.status}</span></td>
              <td>
                <button class="action-btn btn-approve" onclick="approveWithdrawal('${withdrawalKey}', '${withdrawal.userId}', '${withdrawal.withdrawId}')">Approve</button>
                <button class="action-btn btn-reject" onclick="rejectWithdrawal('${withdrawalKey}', '${withdrawal.userId}', '${withdrawal.withdrawId}', ${withdrawal.amount})">Reject</button>
              </td>
            `;
            tbody.appendChild(row);
          }
        });
      });
    }
    
    // Approve Withdrawal
    function approveWithdrawal(adminKey, userId, withdrawId) {
      if (!confirm('Approve this withdrawal?')) return;
      
      // Update withdrawal status in admin
      db.ref(`admin/trading/withdrawals/${adminKey}`).update({
        status: 'approved',
        approvedAt: now()
      });
      
      // Update withdrawal status in user's history
      db.ref(`users/${userId}/trading/withdrawHistory/${withdrawId}`).update({
        status: 'approved',
        approvedAt: now()
      });
      
      notify('Withdrawal approved successfully!');
    }
    
    // Reject Withdrawal
    function rejectWithdrawal(adminKey, userId, withdrawId, amount) {
      if (!confirm('Reject this withdrawal? The amount will be refunded.')) return;
      
      // Refund the amount
      db.ref(`users/${userId}/trading/usdtBalance`).transaction(balance => {
        return (balance || 0) + amount;
      });
      
      // Update withdrawal status in admin
      db.ref(`admin/trading/withdrawals/${adminKey}`).update({
        status: 'rejected',
        rejectedAt: now()
      });
      
      // Update withdrawal status in user's history
      db.ref(`users/${userId}/trading/withdrawHistory/${withdrawId}`).update({
        status: 'rejected',
        rejectedAt: now()
      });
      
      notify('Withdrawal rejected and amount refunded!');
    }
    
    // Load Trades
    function loadTrades() {
      db.ref('admin/trading/purchases').on('value', snapshot => {
        const tbody = document.getElementById('tradesTableBody');
        tbody.innerHTML = '';
        
        if (!snapshot.exists()) {
          tbody.innerHTML = '<tr><td colspan="8"><div class="empty-state"><div class="empty-icon">📭</div><div class="empty-text">No trades yet</div></div></td></tr>';
          return;
        }
        
        snapshot.forEach(child => {
          const trade = child.val();
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${trade.userName}<br><small>${trade.userId}</small></td>
            <td>${trade.pair}</td>
            <td>$${trade.investment}</td>
            <td>$${trade.dailyEarning}</td>
            <td>${trade.daysCompleted}/${trade.duration}</td>
            <td>$${trade.totalEarned.toFixed(2)}</td>
            <td><span class="status-badge status-${trade.status === 'active' ? 'pending' : 'approved'}">${trade.status}</span></td>
            <td>${new Date(trade.timestamp * 1000).toLocaleString()}</td>
          `;
          tbody.appendChild(row);
        });
      });
    }
    
    // Generate Redeem Code
    document.getElementById('generateCodeBtn').addEventListener('click', () => {
      const codeValue = document.getElementById('codeValue').value.trim().toUpperCase();
      const maxUses = parseInt(document.getElementById('codeMaxUses').value) || 100;
      const bulkCount = parseInt(document.getElementById('codeBulkCount').value) || 1;
      
      if (bulkCount > 100) {
        notify('Maximum 100 codes can be generated at once!');
        return;
      }
      
      const codes = [];
      
      for (let i = 0; i < bulkCount; i++) {
        let code;
        if (codeValue && bulkCount === 1) {
          code = codeValue;
        } else {
          // Generate random 5-digit code
          code = Math.random().toString(36).substring(2, 7).toUpperCase();
        }
        
        codes.push(code);
        
        const codeData = {
          code: code,
          maxUses: maxUses,
          usedCount: 0,
          usedBy: {},
          createdAt: now(),
          createdBy: 'admin'
        };
        
        db.ref(`redeemCodes/${code}`).set(codeData);
      }
      
      notify(`Generated ${bulkCount} code(s) successfully!`);
      document.getElementById('codeValue').value = '';
      document.getElementById('codeBulkCount').value = '1';
      
      loadRedeemCodes();
    });
    
    // Load Redeem Codes
    function loadRedeemCodes() {
      db.ref('redeemCodes').on('value', snapshot => {
        const container = document.getElementById('codesList');
        container.innerHTML = '';
        
        if (!snapshot.exists()) {
          container.innerHTML = '<div class="empty-state"><div class="empty-icon">📭</div><div class="empty-text">No codes generated yet</div></div>';
          return;
        }
        
        snapshot.forEach(child => {
          const code = child.val();
          const codeKey = child.key;
          
          const item = document.createElement('div');
          item.className = 'code-item';
          item.innerHTML = `
            <div class="code-info">
              <div class="code-value">${code.code}</div>
              <div class="code-details">
                Used: ${code.usedCount}/${code.maxUses} | 
                Created: ${new Date(code.createdAt * 1000).toLocaleDateString()}
              </div>
            </div>
            <div class="code-actions">
              <button class="action-btn btn-reject" onclick="deleteCode('${codeKey}')">Delete</button>
            </div>
          `;
          container.appendChild(item);
        });
      });
    }
    
    // Delete Code
    function deleteCode(codeKey) {
      if (!confirm('Delete this code?')) return;
      
      db.ref(`redeemCodes/${codeKey}`).remove();
      notify('Code deleted successfully!');
    }
    
    // Search User
    document.getElementById('searchUserBtn').addEventListener('click', () => {
      const userId = document.getElementById('userSearchInput').value.trim();
      
      if (!userId) {
        notify('Please enter a User ID!');
        return;
      }
      
      db.ref(`users/${userId}`).once('value').then(snapshot => {
        const resultDiv = document.getElementById('userSearchResult');
        
        if (!snapshot.exists()) {
          resultDiv.innerHTML = '<div class="empty-state"><div class="empty-icon">❌</div><div class="empty-text">User not found</div></div>';
          return;
        }
        
        const user = snapshot.val();
        const trading = user.trading || {};
        
        resultDiv.innerHTML = `
          <div class="user-result">
            <div class="user-header">
              <img src="${user.avatar}" class="user-avatar" alt="${user.name}" />
              <div class="user-info">
                <div class="user-name">${user.name}</div>
                <div class="user-id">ID: ${userId}</div>
              </div>
            </div>
            
            <div class="user-balances">
              <div class="balance-box">
                <div class="balance-label">SHB Balance</div>
                <div class="balance-value">${user.balance || 0}</div>
              </div>
              <div class="balance-box">
                <div class="balance-label">USDT Balance</div>
                <div class="balance-value">$${(trading.usdtBalance || 0).toFixed(2)}</div>
              </div>
              <div class="balance-box">
                <div class="balance-label">TON Balance</div>
                <div class="balance-value">${(trading.tonBalance || 0).toFixed(2)}</div>
              </div>
              <div class="balance-box">
                <div class="balance-label">Total Deposited</div>
                <div class="balance-value">$${(trading.totalDeposited || 0).toFixed(2)}</div>
              </div>
            </div>
            
            <div class="section-title">
              <span class="section-icon">💰</span>
              Adjust USDT Balance
            </div>
            <div class="balance-actions">
              <input type="number" class="balance-input" id="usdtAdjustAmount" placeholder="Amount" step="0.01" />
              <button class="btn-primary" onclick="adjustBalance('${userId}', 'increase')">Increase</button>
              <button class="btn-danger" onclick="adjustBalance('${userId}', 'decrease')">Decrease</button>
            </div>
          </div>
        `;
      });
    });
    
    // Adjust Balance
    function adjustBalance(userId, action) {
      const amount = parseFloat(document.getElementById('usdtAdjustAmount').value);
      
      if (!amount || amount <= 0) {
        notify('Please enter a valid amount!');
        return;
      }
      
      const confirmMsg = action === 'increase' 
        ? `Increase user's USDT balance by $${amount}?`
        : `Decrease user's USDT balance by $${amount}?`;
      
      if (!confirm(confirmMsg)) return;
      
      db.ref(`users/${userId}/trading/usdtBalance`).transaction(balance => {
        const currentBalance = balance || 0;
        if (action === 'increase') {
          return currentBalance + amount;
        } else {
          return Math.max(0, currentBalance - amount);
        }
      }).then(() => {
        // Log the action
        db.ref('admin/balanceAdjustments').push({
          userId: userId,
          action: action,
          amount: amount,
          timestamp: now(),
          admin: 'admin'
        });
        
        notify(`Balance ${action}d successfully!`);
        document.getElementById('usdtAdjustAmount').value = '';
        
        // Refresh user data
        document.getElementById('searchUserBtn').click();
      });
    }
    
    // Load Redemptions
    function loadRedemptions() {
      db.ref('admin/redemptions').on('value', snapshot => {
        const tbody = document.getElementById('redemptionsTableBody');
        tbody.innerHTML = '';
        
        if (!snapshot.exists()) {
          tbody.innerHTML = '<tr><td colspan="4"><div class="empty-state"><div class="empty-icon">📭</div><div class="empty-text">No redemptions yet</div></div></td></tr>';
          return;
        }
        
        const redemptions = [];
        snapshot.forEach(child => {
          redemptions.push(child.val());
        });
        
        // Sort by timestamp descending
        redemptions.sort((a, b) => b.timestamp - a.timestamp);
        
        redemptions.forEach(redemption => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${redemption.userName}<br><small>${redemption.userId}</small></td>
            <td><strong>${redemption.code}</strong></td>
            <td style="color: #4caf50; font-weight: 700;">$${redemption.reward}</td>
            <td>${new Date(redemption.timestamp * 1000).toLocaleString()}</td>
          `;
          tbody.appendChild(row);
        });
      });
    }
    
    // Initialize
    loadStatistics();
    loadDeposits();
    
    // Refresh statistics every 30 seconds
    setInterval(loadStatistics, 30000);
  </script>
</body>
</html>
